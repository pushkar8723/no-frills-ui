import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import * as DragAndDropStories from './DragAndDrop.stories';

<Meta of={DragAndDropStories} />

# DragAndDrop

`DragAndDrop` is a controlled component and will require `onDrop` prop to function properly.
It can be used to create a re-arrangeable list. It supports both vertical and horizontal orientation for the list.

Additionally, there is a `showIndicator` prop which shows an indicator against the component and the list item
can only be dragged using this indicator when this prop is set to true. This can be used in case the item to be dragged
has some mouse events of its own and we require an explicit user input for drag to handle such case.

> **Limitation**: Currently drag across list is not supported.

**Vertical Layout**

<Canvas of={DragAndDropStories.VerticalLayout} className="canvas-background-alternate" />

**Horizontal Layout**

<Canvas of={DragAndDropStories.HorizontalLayout} className="canvas-background-alternate" />

**Horizontal Layout with indicators**

<Canvas of={DragAndDropStories.HorizontalWithIndicators} className="canvas-background-alternate" />

```jsx
import React, { useState } from 'react';
import { DragAndDrop, ORIENTATION } from 'no-frills-ui';

export default function DragAndDropDemo(prop) {
    const [items, setItems] = useState(['Item #1', 'Item #2', 'Item #3', 'Item #4', 'Item #5']);

    const onDrop = (start, end) => {
        // Clone existing elements
        const newItems = [...items];
        // Remove the element to be moved
        const item = newItems.splice(start, 1);
        // Add it back at the required position
        newItems.splice(end, 0, item[0]);
        // Update
        setItems(newItems);
    };

    return (
        <DragAndDrop orientation={ORIENTATION.VERTICAL} onDrop={onDrop}>
            {items.map((item) => (
                <div>{item}</div>
            ))}
        </DragAndDrop>
    );
}
```

## Props

<Controls of={DragAndDropStories.Primary} />

## CSS Variables used

| Variable Name          | Description                                        |
| :--------------------- | :------------------------------------------------- |
| `--nfui-disabled`      | Used for `color`.                                  |
| `--nfui-primary`       | Used for focus `box-shadow` and drop zone borders. |
| `--nfui-primary-light` | Used for focus `box-shadow`.                       |

## Accessibility

This component meets **WCAG 2.1 Level AA** standards.

### Keyboard Navigation

- **Tab**: Navigate to items
- **Space**: Grab/drop item
- **Arrow Keys** (while grabbed): Move item up/down or left/right
- **Enter** (while grabbed): Drop at current position
- **Escape** (while grabbed): Cancel and restore to original position

### Screen Reader Support

- **Semantic Structure**: List presented with `role="list"` and `role="listitem"`
- **Descriptive Labels**: Each item announces position and keyboard instructions
- **Live Announcements**: Real-time feedback for grab, move, drop, and cancel actions
- **Drag State**: `aria-grabbed` indicates when an item is being dragged

### Visual Feedback

- **Focus Indicator**: Clear box-shadow on keyboard focus
- **Drop Zones**: Dashed borders show where item will be dropped
- **Dragging State**: 50% opacity while item is being moved

### Internationalization (i18n)

All announcements and labels support customization with auto-injecting keyboard key names:

**Available Props:**

- `itemAriaLabelTemplate` - Item aria-label with instructions
- `dragHandleAriaLabel` - Drag handle label (when `showIndicator` is true)
- `grabbedAnnouncementTemplate` - Announcement when item is grabbed
- `movedAnnouncementTemplate` - Announcement when item position changes
- `droppedAnnouncementTemplate` - Announcement when item is dropped
- `cancelledAnnouncementTemplate` - Announcement when drag is cancelled

**Placeholders:**

- `{:position}` - Item position number
- `{:grabKey}`, `{:dropKey}`, `{:altDropKey}`, `{:cancelKey}` - Auto-inject keyboard keys
- `{:moveKeys}` - Orientation-aware arrow key names

Example with Spanish:

```tsx
<DragAndDrop
    orientation={ORIENTATION.VERTICAL}
    onDrop={onDrop}
    itemAriaLabelTemplate="Elemento {:position}. Presiona {:grabKey} para agarrar, {:moveKeys} para mover"
    grabbedAnnouncementTemplate="Elemento {:position} agarrado. Usa {:moveKeys} para mover, {:dropKey} para soltar, {:cancelKey} para cancelar"
    movedAnnouncementTemplate="Elemento movido a posiciÃ³n {:position}"
/>
```

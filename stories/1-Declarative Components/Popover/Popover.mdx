import { Meta, Canvas, Controls } from '@storybook/addon-docs/blocks';
import * as PopoverStories from './Popover.stories';

<Meta of={PopoverStories} />

# Popover

A component that renders as a card relative to a given element. This can be used to implement custom
dropdowns or menu. When the popover opens, it check if it can fit into the viewport and tries to
adjust itself such that there is no overflow. It also automatically closes on click anywhere outside
the container.

<div>{PopoverStories.Positions.render()}</div>

```jsx
import { useState, forwardRef } from 'react';
import { Popover, POPOVER_POSITION, Button } from 'no-frills-ui';

const [open, setOpen] = useState(false);

// IMPORTANT: The trigger element must forward refs for focus restoration to work
const TriggerButton = forwardRef((props, ref) => (
    <Button ref={ref} onClick={() => setOpen(!open)} {...props}>
        Open Popover
    </Button>
));

// render
<Popover
    open={open}
    position={POPOVER_POSITION.TOP_RIGHT}
    element={TriggerButton}
    onClose={() => setOpen(false)}
>
    Popover Content goes here
</Popover>;
```

## Props

<Controls of={PopoverStories.Primary} />

## CSS Variables Used

| Variable Name         | Description                  |
| :-------------------- | :--------------------------- |
| `--nfui-background`   | Used for `background-color`. |
| `--nfui-shadow`       | Used for `box-shadow`.       |
| `--nfui-modal-shadow` | Used for `box-shadow`.       |

## Accessibility

The Popover component is fully compliant with WCAG 2.1 AA guidelines:

- **Semantic Role**: Uses `role="dialog"` to properly identify the popover as a dialog container for assistive technologies.
- **ARIA Relationships**: The trigger element is associated with the popover via unique `aria-controls` and `aria-labelledby` attributes, ensuring screen readers can navigate the relationship.
- **State Announcement**: The `aria-expanded` attribute announces the open/closed state of the popover to screen readers.
- **Popup Type**: Uses `aria-haspopup="dialog"` to inform users that activating the trigger will open a dialog.
- **Keyboard Support**:
    - **ESC key** closes the popover (configurable via `closeOnEsc` prop)
    - **Tab/Shift+Tab** navigation is trapped within the popover to prevent focus from escaping to background content
    - Focus automatically moves to the popover when it opens
- **Focus Management**:
    - Implements a focus trap that keeps keyboard navigation contained within the popover while open
    - **Focus Restoration**: Automatically returns focus to the trigger element when the popover closes
    - **IMPORTANT**: The `element` prop must use `React.forwardRef()` to properly forward the ref for focus restoration to work correctly
- **Click Outside**: Automatically closes when clicking outside the popover container.
- **Viewport Awareness**: Automatically adjusts position to prevent overflow and ensure content remains visible.
